# DirectX11 모작 개인 포트폴리오 : BPM : Bullets Per Minute

![img](https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/1286350/header.jpg?t=1667228772)

리소스가 포함되어있지 않은 코드 공개용 리포지토리입니다. 정상적으로 동작하지 않을 가능성이 매우 높습니다.

개발 기간 : 2024.06 ~ 2024.08

장르 : 1인칭 리듬 액션 슈터

기술 스택:
C, C++, STL, FMOD, Win API, DLL, DirectX 11, HLSL, Effects11, Assimp, ImGui, ImGuizmo, DirectXTK, DirectMath, Nvidia PhysX 5.3 , DLL

제 다른 작업물은 [여기](https://github.com/sturdyChair/portfolio)서 볼 수 있습니다!

---

## 시연 영상 링크 

[BPM 데모](https://youtu.be/o1cv1M6C4Eo)

---

## 목적 및 설명
포트폴리오 제작을 위해 개발된 1인칭 리듬 액션 슈터 게임 BPM의 모작 프로젝트입니다.
상용 엔진을 이용하지 않았으며 DirectX11을 이용해 개발한 엔진을 DLL 프로젝트로 클라이언트 프로젝트에 Export하여 개발했습니다.

---

## 주요 구현 기능

## 1. DirectX 11 기반 렌더링 엔진
### 렌더링
- **디퍼드 라이팅**: 연산 부하를 줄이기 위해 G-Buffer 활용
  - G-Buffer 데이터: `Color`, `Id`, `Position`, `Normal`, `Emissive`.
    > `Id`버퍼는 픽셀 피킹 등 개발 편의성을 위해 마련됨
    > 
    > G-Buffer 데이터를 이용해 다양한 셰이더 효과를 구현
- **PBR**: 
  - GGX와 Schlick Fresnel을 이용해 라이팅 엔진에 PBR 적용

---

## 2. 최적화 작업
### Assimp 라이브러리 활용
- **FBX 데이터 처리**:
  - 모델 데이터를 구조체로 선언, 구조체를 **이진 직렬화**하여 파일로 저장
  - 전처리 과정이 끝난 FBX파일은 더이상 사용하지 않으며 이진화된 파일을 이용
  - Texture Caching을 통해 동일 텍스쳐의 중복 로딩 방지
  - 멀티 스레딩을 이용한 병렬 로딩
- **로딩 시간 단축**:
  - 결과적으로 30분 이상이었던 로딩 시간을 2분까지 단축
  - 주로 **이진 직렬화**에서 효과를 봄(30분->5분)
  - 멀티 스레딩을 이용해 CPU 점유율을 끌어올리고 최종적으로 로딩 시간을 2분까지 단축
### Object Pooling
- **레퍼런스 카운터**
  - 직접 레퍼런스 카운터를 제어해 객체가 게임 루프에서 제거되어도 소멸자가 호출되지 않도록 함함
  - 메모리의 할당, 해제 없이 대량의 객체를 순간적으로 생성할 수 있음 
- **초기화**:
  - Pool에 배치된 오브젝트는 게임 루프에 포함되거나 게임 루프에서 제거될 때 특수한 Callback 함수를 호출함
  - Callback 함수는 각 Object에서 직접 구현, 필요한 초기화 작업을 수행함

---

## 3. 충돌 처리
### PhysX 엔진
- 지형과 캐릭터의 상호작용, 충돌 관리
- **메쉬 콜라이더**:
  - 메쉬와 동일한 모양의 충돌체, 주로 지형에 사용됨
  - PhysX 엔진에 메쉬의 정점 정보를 전달해 만들어짐
- **Character Controller(CCT)**:
  - 캡슐 모양의 충돌체
  - PhysX로 구성된 지형과 상호작용하기 위해 **움직이는 객체**가 가지고 있는 Component 객체
  - 주로 플레이어, 몬스터 AI등이 소유하고 있으며 이동을 제어함
### Collision Manager
- 전투, 상호작용, 이벤트 처리 등 게임 로직에 필요한 충돌 처리를 담당하는 객체
- 충돌 처리가 필요한 객체는 Collider Component를 소유, 매 프레임 Collider를 Collision Manager에 등록함
- 등록되지 않은 Collider는 유효하지 않은 것으로 판별, 그 프레임에서 충돌 처리를 하지 않음
- Collider는 Collision Group으로 나뉘며 그룹 기반으로 충돌 검사 시행
- 각 Collider가 가지고 있는 고유 ID를 이용해 각 Collider 쌍의 충돌 상태를 저장함
 
---

## 4. 플레이어
- **이동**
  - 기본 xz축 이동과 점프, 기존 이동방향으로 빠르게 움직이는 대쉬, 점프, 내려찍기 등을 구현
  - CCT와 직접 구현한 유사 물리 시뮬레이트를 이용해 다양한 움직임을 구현함
- **무기**
  - 손 메시의 본에 총 객체를 동기화
  - 들고있는 무기 종류에 따라 같은 입력에도 다른 애니메이션을 재생
- **카메라**
  - 1인칭 카메라를 플레이어와 동기화
- **TPS 플레이어**
  - 기존 플레이어 객체를 상속해 완전히 다른 3인칭 플레이어를 개발
  - 상속 덕분에 다른 구현을 해치지 않고 유연하게 플레이어블 캐릭터를 바꿀 수 있음
  - 애니메이션 분리제어를 통해 상체와 하체가 서로 다른 애니메이션을 재생 가능, 이를 통해 공격과 동시에 이동하는 모습을 자연스럽게 보여줌

---

## 5. 셰이더
- **Dissolve**
  - 몬스터 사망시 자연스럽게 사라지는 처리
  - 그 외에도 화면전환, 스킬 이펙트 등에 다양하게 사용됨
- **Glow**
  - 빛나는 객체에 번짐효과를 추가
- **레이더 효과**
  - 특정 지점으로부터 원형으로 뻗어나가는 효과
  - G-Buffer정보를 통해 지형에 붙어 뻗어나가는 효과를 연출함

---

## 6. 아이템
- **인터페이스**
  - 충돌 함수를 미리 구현해둔 객체를 다시 상속해 다양한 아이템을 구현
  - 체력 회복, 골드 획득, 실드 획득 아이템 같은 1회성 아이템과 무기, 장착 아이템을 분리시켜 작동방식을 다르게 함
  - 상점에 소유된 아이템은 가격이 존재해 표시되는 UI와 작동방식이 달라짐

---

## 트러블슈팅

